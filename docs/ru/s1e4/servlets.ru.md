# Servlets

[..](./README.md)

Сервлеты - это Java классы, которые расширяют функциональность сервера. Они обрабатывают запросы от клиентов и генерируют соответствующие ответы. Сервлеты обычно используются для создания веб-приложений на платформе Java.

## Методы жизненного цикла

Жизненный цикл сервлета включает в себя несколько методов, которые определяются в классе сервлета и вызываются контейнером сервлетов в разные моменты времени. Вот основные методы жизненного цикла сервлета и их назначение:

1. **init()**: Этот метод вызывается контейнером сервлетов при инициализации сервлета. Он используется для выполнения любой инициализации, необходимой для работы сервлета, например, загрузка ресурсов, настройка параметров и т. д. Этот метод вызывается только один раз во время жизни сервлета.

2. **service()**: Этот метод вызывается контейнером сервлетов для обработки каждого запроса к сервлету. В этом методе реализуется основная логика обработки запросов, например, чтение параметров запроса, выполнение бизнес-логики и формирование ответа.

3. **doGet() / doPost() / doPut() / doDelete() и т. д.**: Эти методы представляют собой обработчики HTTP-методов GET, POST, PUT, DELETE и других соответственно. Они вызываются внутри метода service() в зависимости от типа запроса, который пришел к сервлету. Реализация этих методов позволяет сервлету обрабатывать соответствующие типы запросов.

4. **destroy()**: Этот метод вызывается контейнером сервлетов перед тем, как сервлет будет уничтожен. Он используется для освобождения ресурсов, завершения потоков выполнения и других операций, необходимых для корректного завершения работы сервлета.

Чтобы работать с методами жизненного цикла сервлета, вам нужно переопределить соответствующие методы в вашем классе сервлета и реализовать в них необходимую логику. Например, вы можете переопределить метод init() для инициализации переменных и ресурсов, метод service() для обработки запросов и формирования ответов, и метод destroy() для освобождения ресурсов и завершения работы сервлета.

Ниже приведен пример кода сервлета, который реализует все методы REST: GET, POST, PUT и DELETE. Для простоты мы реализуем сервлет, который управляет ресурсом "tasks" (задачи).

```java
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import java.util.*;

public class TaskServlet extends HttpServlet {

    private Map<Integer, String> tasks = new HashMap<>();
    private int taskIdCounter = 0;

    // Обработка GET запроса для получения всех задач
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        response.setContentType("application/json");
        PrintWriter out = response.getWriter();
        out.println(tasks);
    }

    // Обработка POST запроса для создания новой задачи
    @Override
    protected void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        String taskDescription = request.getParameter("description");
        tasks.put(taskIdCounter++, taskDescription);
        response.setStatus(HttpServletResponse.SC_CREATED);
    }

    // Обработка PUT запроса для обновления существующей задачи
    @Override
    protected void doPut(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        int taskId = Integer.parseInt(request.getParameter("id"));
        String taskDescription = request.getParameter("description");
        if (tasks.containsKey(taskId)) {
            tasks.put(taskId, taskDescription);
            response.setStatus(HttpServletResponse.SC_OK);
        } else {
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
        }
    }

    // Обработка DELETE запроса для удаления задачи
    @Override
    protected void doDelete(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        int taskId = Integer.parseInt(request.getParameter("id"));
        if (tasks.containsKey(taskId)) {
            tasks.remove(taskId);
            response.setStatus(HttpServletResponse.SC_OK);
        } else {
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
        }
    }
}
```

Этот пример демонстрирует базовую реализацию сервлета, который обрабатывает методы REST для управления списком задач. Каждый метод (`doGet`, `doPost`, `doPut`, `doDelete`) соответствует соответствующему HTTP-методу и выполняет операции чтения, создания, обновления и удаления задач.

## Контейнеры сервлетов

Контейнер сервлетов (Servlet Container), также известный как сервлет-контейнер, это часть сервера, которая обеспечивает среду выполнения для сервлетов. Он управляет жизненным циклом сервлетов, обрабатывает запросы от клиентов и направляет их на соответствующие сервлеты, а затем отправляет ответы клиентам.

Сервлет-контейнеры реализуют спецификацию Java Servlet API, определенную в рамках Java EE (Enterprise Edition) или Jakarta EE (ранее Java EE). Они предоставляют реализацию этой спецификации, которая позволяет разработчикам создавать веб-приложения с использованием сервлетов.

Некоторые известные контейнеры сервлетов:

1. **Apache Tomcat**: Tomcat - это самый популярный и широко используемый контейнер сервлетов. Он легко настраивается, легковесен и отлично подходит для разработки и тестирования веб-приложений на Java.

2. **Jetty**: Jetty - это еще один популярный и легковесный контейнер сервлетов. Он обладает высокой производительностью и хорошо масштабируется, что делает его подходящим для развертывания в продакшене.

3. **WildFly (ранее JBoss)**: WildFly представляет собой полноценный Java EE приложенный сервер, который включает в себя контейнер сервлетов, а также множество других возможностей для разработки и развертывания приложений на Java.

4. **GlassFish**: GlassFish - еще один полноценный Java EE приложенный сервер, который включает в себя контейнер сервлетов и другие сервисы для веб-разработки.

Контейнеры сервлетов обычно работают следующим образом:

1. **Инициализация**: Когда сервер запускается, контейнер сервлетов инициализирует все сервлеты, определенные в конфигурации веб-приложения.

2. **Обработка запросов**: Когда клиент отправляет запрос на сервер, контейнер сервлетов принимает этот запрос и определяет, какой сервлет должен обработать его на основе URL-адреса запроса.

3. **Вызов сервлета**: Контейнер сервлетов вызывает методы соответствующего сервлета для обработки запроса (например, `doGet`, `doPost` и т. д.).

4. **Формирование ответа**: После обработки запроса сервлет возвращает результаты обработки, которые контейнер сервлетов отправляет обратно клиенту в виде HTTP-ответа.

5. **Уничтожение**: При завершении работы сервера контейнер сервлетов уничтожает все сервлеты и освобождает ресурсы.

Контейнеры сервлетов предоставляют надежную и эффективную среду выполнения для веб-приложений на Java, обеспечивая высокую производительность и удобство разработки.

Вот простая инструкция о том, как написать приложение с использованием сервлета:

1. **Создайте проект**: Создайте новый проект Java в вашей среде разработки (например, IntelliJ IDEA, Eclipse) или с помощью инструмента управления проектами Maven или Gradle.

2. **Добавьте зависимости**: Если вы используете Maven или Gradle, добавьте зависимости для сервлета. Для сервлетов вам понадобится зависимость от `javax.servlet-api`.

3. **Напишите сервлет**: Создайте класс сервлета, который расширяет `HttpServlet` и переопределяет методы, такие как `doGet`, `doPost`, `doPut`, `doDelete`, в зависимости от ваших потребностей.

4. **Настройте маппинг сервлета**: Укажите URL-адрес, по которому будет доступен ваш сервлет, в файле конфигурации веб-приложения (web.xml) или аннотацией `@WebServlet`, если вы используете архитектуру Servlet 3.0 и выше.

5. **Создайте веб-страницы (опционально)**: Если ваше приложение предполагает взаимодействие с пользователем через веб-интерфейс, создайте соответствующие HTML или JSP страницы, которые будут использовать ваш сервлет.

6. **Соберите и разверните приложение**: Соберите ваше приложение и разверните его на веб-сервере. Для этого может понадобиться настройка конфигурации в вашей среде разработки или использование инструментов управления серверами, таких как Apache Tomcat, Jetty или WildFly.

Пример кода сервлета, который мы рассмотрели ранее, демонстрирует базовую реализацию, которую можно использовать в качестве отправной точки. В дальнейшем вы можете расширить функциональность вашего сервлета и взаимодействие с ним в соответствии с потребностями вашего приложения.
